library(raster)
library(sp)
library(maptools)
library(rasterVis)
library(RColorBrewer)
library(spatstat)
library(plyr)
library(vegan)
bci <- read.table("../data/PlotDataReport12-09-2015_1179045564.txt", header=T, sep="\t")
# removing the NAs
bci <- bci[is.na(bci$PX)==FALSE,]
bci <- bci[, c("Latin","PX","PY")]
my.green <- col2rgb(brewer.pal(9, "Greens")[8])
my.green <- rgb(my.green[1]/256, my.green[2]/256, my.green[3]/256, alpha=0.1)
par(oma=c(0,0,0,0))
plot(c(0,2000),c(0, 2000), type="n", axes=FALSE, xlab="x [m]", ylab="y [m]")
axis(1); axis(2)
points(bci$PX, bci$PY, cex=0.1, col=my.green)
rect(0,0,2000,2000)
Thomas <- function(x, y) # x and y coordinates of the points
{
if(length(x)==1) # in case there is just a single point
{
return(c(kappa=1/(1000*500), sigma=1, mu=1))
}
else # fit the Thomas model and return the parameters
{
W <- as.owin(list(xrange=c(0,1000), yrange=c(0,500)))
xy <- as.ppp(cbind(x, y), W)
fit.xy <- clusterfit(xy, clusters="Thomas")
return(fit.xy$modelpar)
}
}
Thomas <- function(x, y) # x and y coordinates of the points
{
if(length(x)==1) # in case there is just a single point
{
return(c(kappa=1/(1000*500), sigma=1, mu=1))
}
else # fit the Thomas model and return the parameters
{
W <- as.owin(list(xrange=c(0,1000), yrange=c(0,500)))
xy <- as.ppp(cbind(x, y), W)
fit.xy <- clusterfit(xy, clusters="Thomas")
return(fit.xy$modelpar)
}
}
Thomas.plot <- function(spec.name, bci)
{
sp <- bci[bci$Latin==spec.name,]
sp.fit <- Thomas(sp$PX, sp$PY)
W2000 <- as.owin(list(xrange=c(0,2000), yrange=c(0,2000)))
sp.pred <- rThomas(sp.fit['kappa'],
sp.fit['sigma'],
sp.fit['mu'],
win=W2000)
plot(sp.pred, pch=19, cex=0.3, cols="black", main=spec.name)
rect(0,0,1000,500, col="white")
points(sp$PX, sp$PY, col="red", pch=19, cex=0.3)
}
par(mfrow=c(3,2), mai=c(0.1,0.1, 0.5, 0.5))
Thomas.plot("Hybanthus prunifolius", bci)
Thomas.plot("Acalypha diversifolia", bci)
Thomas.plot("Bactris major", bci)
Thomas.plot("Triplaris cumingiana", bci)
Thomas.plot("Ficus popenoei", bci)
Thomas.plot("Ormosia amazonica", bci)
abund <- ddply(.data=bci,
.variables="Latin",
.fun=summarize,
Abundance=length(Latin))
Thomas.res <- list()
for(i in 1:nrow(abund))
{
spec <- as.character(abund[i, 'Latin'])
bci.sub <- bci[bci$Latin==spec,]
Thomas.res[[i]] <- c(Thomas(bci.sub$PX, bci.sub$PY))
}
Thomas.res <- ldply(Thomas.res)
Thomas.res <- data.frame(abund, Thomas.res)
# define the 2x2 km window
W2000 <- as.owin(list(xrange=c(0,2000), yrange=c(0,2000)))
abund.ext <- numeric() # empty container for the results
for(i in 1:nrow(abund))
{
spec <- as.character(abund[i, 'Latin'])
spec.2km <- rThomas(kappa=Thomas.res[i, 'kappa'],
scale=Thomas.res[i, 'sigma'],
mu=Thomas.res[i, 'mu'],
win=W2000)
abund.ext[i] <- spec.2km$n
}
Thomas.res <- data.frame(Thomas.res, Abundance.ext=abund.ext)
write.csv(Thomas.res, file="BCI_Thomas.csv", row.names = FALSE)
Thomas.res
par(mfrow=c(2,2), mai=c(0.8, 0.8, 0.1, 0.1))
hist(log10(Thomas.res$Abundance), col="grey", main="",
xlab="log10 Abundance (500 x 1000)", breaks=30)
hist(log10(Thomas.res$Abundance.ext), col="grey", main="",
xlab="log10 Abundance (2000 x 2000)", breaks=30)
plot(sort(log10(Thomas.res$Abundance), decreasing=TRUE),
ylab="Log10 Abundance (500 x 1000)")
plot(sort(log10(Thomas.res$Abundance.ext), decreasing=TRUE),
ylab="Log10 Abundance (2000 x 2000)")
pairs(log10(Thomas.res[,2:6]))
W2000
raster(W2000)
20*20
